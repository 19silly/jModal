/*
 * jModal.js (a simple image and video modal)
 * version 0.3
 * (c) 2012 Jeremy Fields [jeremy.fields@viget.com]
 * released under the MIT license
 */

(function(b,a,c){b.jModal=function(){var y,p,f;var w=function(){$(".jmodal").on("click",function(z){z.preventDefault();n($(this))})};var j=function(z){y.find(".jmodal-content").html(z);k()};var o=function(A){var z='<object width="640" height="390"><param name="movie" value="http://www.youtube.com/v/'+l(A)+'?version=3&amp;hl=en_US&amp;rel=0&amp;autoplay=1"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="http://www.youtube.com/v/'+l(A)+'?version=3&amp;hl=en_US&amp;rel=0&amp;autoplay=1" type="application/x-shockwave-flash" width="640" height="390" allowscriptaccess="always" allowfullscreen="true"></embed></object>';y.find(".jmodal-content").html(z);k()};var l=function(B){var E=B.split("?");var D=E[1].split("&");var z="";for(var C=0;C<D.length;C++){if(D.indexOf("v=")){var A=D[C].split("=");z=A[1];break}}return z};var s=function(A){var z=$(A).html();y.find(".jmodal-content").addClass("jmodal-text").html(z);k()};var h=function(B){var z="";var A=1;$("[rel="+B.attr("rel")+"]").each(function(){var C=($(this).attr("href")===B.attr("href"))?"selected":"";z+='<a href="'+$(this).attr("href")+'" class="jmodal-gallery-link '+C+'">'+A+"</a>";A++});y.addClass("jmodal-modal-gallery").append('<p class="jmodal-gallery-links"><a href="#" class="jmodal-gallery-prev">Prev</a>'+z+'<a href="#" class="jmodal-gallery-next">Next</a></p>');f=y.find(".selected");g()};var g=function(){$(".jmodal-gallery-link, .jmodal-gallery-prev, .jmodal-gallery-next").on("click",function(z){z.preventDefault();d($(this))})};var d=function(B){if(B.hasClass("jmodal-gallery-prev")){var A=f.prev().not(B);if(A.length!==0){q(A)}}else{if(B.hasClass("jmodal-gallery-next")){var z=f.next().not(B);if(z.length!==0){q(z)}}else{if(!B.hasClass("selected")){q(B)}}}};var q=function(z){v(z);y.find(".jmodal-content").addClass("loading").find("img").animate({opacity:0},100);e(z.attr("href"),i)};var v=function(z){f.removeClass("selected");f=z.addClass("selected")};var i=function(A){var B=y.find(".jmodal-content").removeClass("loading").empty();var C=$(A);C.appendTo(B).css({opacity:0});var z=y.outerWidth();var D=y.outerHeight();y.css({"margin-top":t(D),"margin-left":t(z)});C.animate({opacity:1},300)};var n=function(z){x();if(z.data("type")==="image"){if(z.attr("rel")){h(z)}e(z.attr("href"),j)}else{if(z.data("type")==="video"){o(z.attr("href"))}else{s(z.attr("href"))}}};var x=function(){y=$('<div id="jmodal"><div class="jmodal-content"></div><a href="#" class="jmodal-close">Close</a></div>').appendTo("body");$(".jmodal-close").on("click",function(z){z.preventDefault();m()})};var k=function(){var z=y.outerWidth();var A=y.outerHeight();y.css({"margin-top":t(A),"margin-left":t(z)}).addClass("show");u()};var m=function(){y.removeClass("show");r();window.setTimeout(function(){y.removeClass("jmodal-modal-gallery").find(".jmodal-content").removeClass("text");y.find(".jmodal-gallery-links").remove();y.remove()},500)};var e=function(A,B){var z=document.createElement("img");z.onload=function(){B(z)};z.src=A};var t=function(z){return(z/2)*-1};var u=function(){if(!p){p=$('<div id="UIBlock" />').css({opacity:0}).appendTo("body").animate({opacity:0.6},200).on("click",function(){m()})}};var r=function(){p.fadeOut(200,function(){$(this).remove();p=""})};w()}}(this,this.document));