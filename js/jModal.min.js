/*
	jModal.js (a simple image and video modal)
	version 0.2
	(c) 2012 Jeremy Fields [jeremy.fields@viget.com]
	released under the MIT license
*/
(function(c,b,a){c.jModal=function(o){var u="";var r="";var t="";var v="";var s=function(){$(".jmodal").click(function(x){x.preventDefault();var w=$(this);i($("body"));(w.data("type")==="image")?h(w,p):n(w,p)});if(!Array.prototype.indexOf){Array.prototype.indexOf=function(y,z){for(var x=(z||0),w=this.length;x<w;x++){if(this[x]===y){return x}}return -1}}};var h=function(z,y){var x=z;var w=document.createElement("img");w.onload=function(){y(w,z)};w.src=x.attr("href")};var n=function(z,y){var x=z;var w='<iframe width="640" height="390" src="http://www.youtube.com/embed/'+k(x.attr("href"))+'" frameborder="0" allowfullscreen></iframe>';y(w,x)};var k=function(y){var B=y.split("?");var A=B[1].split("&");var w="";for(var z=0;z<A.length;z++){if(A.indexOf("v=")){var x=A[z].split("=");w=x[1];break}}return w};var p=function(B,A){u=$('<div id="jmodal-modal"><div class="jmodal-content"></div><a href="#" class="jmodal-close">X</a></div>').appendTo("body");r=u.find(".jmodal-content");j();l();f(A);r.append(B);var x=u.outerHeight();var z=u.outerWidth();var w=r.height();var y=r.width();u.css({height:w,width:y});u.css({"margin-left":((z/2)*-1),top:((x*-1)-20)}).delay(400).animate({top:(((x-$(window).height())/2)*-1)},300,function(){m(u);u.css({"margin-top":((x/2)*-1),top:"50%"})})};var m=function(y){var x=$(y);var w=x.outerHeight();$(".jmodal-close, #UIBlock").click(function(z){z.preventDefault();x.css({"margin-top":0,top:x.offset().top}).animate({top:((w*-1)-20)},300,function(){x.remove();q()})})};var f=function(y){var x="";if($(y).attr("rel")){var w=1;$("[rel="+$(y).attr("rel")+"]").each(function(){var z=($(this).attr("href")===$(y).attr("href"))?"selected":"";x+='<a href="'+$(this).attr("href")+'" class="jmodal-gallery-link '+z+'">'+w+"</a>";w++});u.addClass("jmodal-modal-gallery").append('<p class="jmodal-gallery-links"><a href="#" class="jmodal-gallery-prev">Prev</a>'+x+'<a href="#" class="jmodal-gallery-next">Next</a></p>');t=u.find(".selected");e()}};var e=function(){$(".jmodal-gallery-link").click(function(x){x.preventDefault();var w=$(this);if(!w.hasClass("selected")){d(w)}});$(".jmodal-gallery-prev").click(function(x){x.preventDefault();var w=t.prev().not(this);if(w.length!==0){d(w)}});$(".jmodal-gallery-next").click(function(x){x.preventDefault();var w=t.next().not(this);if(w.length!==0){d(w)}})};var d=function(w){r.find("img").animate({opacity:0},100);h(w,g)};var g=function(x,A){r.empty();t.removeClass("selected");t=$(A).addClass("selected");var y=$(x);y.appendTo(r).css({opacity:0});var w=y.height();var z=y.width();u.animate({height:w,"margin-left":((z+32)/2)*-1,"margin-top":((w+86)/2)*-1,width:z},300,function(){y.animate({opacity:1},300)})};var l=function(){if($("#UIBlock").length===0){$('<div id="UIBlock" />').css({background:"#000",height:"100%",left:0,opacity:0,position:"fixed",top:0,width:"100%",zIndex:900}).appendTo("body").animate({opacity:0.8},100);if($.browser.msie&&($.browser.version<7)){$("#UIBlock").css({position:"absolute",top:$(window).scrollTop()})}}};var q=function(){$("#UIBlock").fadeOut(100,function(){$(this).remove()})};var i=function(w){v=$('<div id="carousel-busyloader"></div>').appendTo(w).css({opacity:0,"margin-top":-50}).animate({opacity:1,"margin-top":-30},300)};var j=function(){v.animate({opacity:0,"margin-top":-50},200,function(){v.remove()})};s()}}(this,this.document));